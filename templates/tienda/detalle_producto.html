{% extends 'base.html' %}
{% load humanize %}

{% block content %}
<style>
    .galeria-css input { display: none; }
    .galeria-css .main-img-box img { display: none; opacity: 0; transition: opacity 0.5s; }
    
    #pic-0:checked ~ div .img-0 { display: block; opacity: 1; }
    {% for img in p.imagenes.all %}
    #pic-{{ forloop.counter }}:checked ~ div .img-{{ forloop.counter }} { display: block; opacity: 1; }
    {% endfor %}

    #pic-0:checked ~ div label[for="pic-0"] { border-color: #e11d48; }
    {% for img in p.imagenes.all %}
    #pic-{{ forloop.counter }}:checked ~ div label[for="pic-{{ forloop.counter }}"] { border-color: #e11d48; }
    {% endfor %}
</style>

<div class="container mx-auto px-6 py-10 galeria-css">
    <div class="grid grid-cols-1 md:grid-cols-2 gap-16 items-start">
        
        <!-- SELECTORES INVISIBLES (RADIO BUTTONS) -->
        <input type="radio" name="galeria" id="pic-0" checked>
        {% for img in p.imagenes.all %}
            <input type="radio" name="galeria" id="pic-{{ forloop.counter }}">
        {% endfor %}

        <!-- LADO IZQUIERDO: IMÁGENES -->
        <div class="flex flex-col space-y-6">
            <!-- IMAGEN PRINCIPAL -->
            <div class="main-img-box relative bg-white p-8 md:p-12 rounded-[40px] border border-zinc-100 shadow-sm flex items-center justify-center h-[400px] md:h-[500px] overflow-hidden">
                {% if p.imagen %}
                    <img src="{{ p.imagen.url }}" class="img-0 max-h-full w-auto object-contain">
                {% else %}
                    <img src="https://via.placeholder.com/500x500?text=Sin+Imagen" class="img-0 max-h-full w-auto object-contain opacity-20">
                {% endif %}

                {% for img in p.imagenes.all %}
                    <img src="{{ img.imagen_url }}" class="img-{{ forloop.counter }} max-h-full w-auto object-contain">
                {% endfor %}
            </div>

            <!-- MINIATURAS  -->
            <div class="flex flex-wrap gap-4 justify-center md:justify-start">
                {% if p.imagen %}
                <label for="pic-0" class="w-20 h-20 border-2 border-zinc-100 rounded-2xl p-2 cursor-pointer transition flex items-center justify-center bg-white shadow-sm hover:border-red-600">
                    <img src="{{ p.imagen.url }}" class="max-h-full object-contain">
                </label>
                {% endif %}

                {% for img in p.imagenes.all %}
                <label for="pic-{{ forloop.counter }}" class="w-20 h-20 border-2 border-zinc-100 rounded-2xl p-2 cursor-pointer transition flex items-center justify-center bg-white shadow-sm hover:border-red-600">
                    <img src="{{ img.imagen_url }}" class="max-h-full object-contain">
                </label>
                {% endfor %}
            </div>
        </div>

        <!-- LADO DERECHO: INFORMACIÓN -->
        <div class="flex flex-col pt-4">
            <span class="text-red-600 font-black text-[10px] uppercase tracking-[0.4em] mb-4 italic">
                {% if p.tag %}{{ p.tag }}{% else %}PRODUCTO{% endif %} | {{ p.categoria.nombre }}
            </span>
            
            <h1 class="text-4xl md:text-5xl font-black italic uppercase tracking-tighter text-zinc-900 mb-6 leading-none">
                {{ p.nombre }}
            </h1>

            <!-- Stock Badge -->
            <div class="mb-6 flex items-center space-x-2">
                {% if p.stock == 'disponible' %}
                    <span class="flex h-2 w-2 rounded-full bg-green-500 animate-pulse"></span>
                    <span class="text-[10px] font-bold text-green-600 uppercase tracking-widest">En Stock - Disponible</span>
                {% elif p.stock == 'consulta' %}
                    <span class="flex h-2 w-2 rounded-full bg-blue-500"></span>
                    <span class="text-[10px] font-bold text-blue-600 uppercase tracking-widest">Bajo Consulta</span>
                {% else %}
                    <span class="flex h-2 w-2 rounded-full bg-red-500"></span>
                    <span class="text-[10px] font-bold text-red-500 uppercase tracking-widest">Agotado</span>
                {% endif %}
            </div>
            
            <div class="mb-8">
                <span class="text-5xl font-black text-zinc-900 italic">Gs {{ p.precio|floatformat:0|intcomma }}</span>
            </div>

            <!-- Descripción -->
            <div class="bg-zinc-50 border-l-4 border-red-600 p-8 rounded-r-3xl mb-10 italic text-gray-600 leading-relaxed text-lg shadow-sm">
                {{ p.descripcion }}
            </div>

            <!-- Botones de Acción -->
            <div class="flex flex-wrap items-center gap-6">
                {% if p.stock == 'disponible' %}
                    <a href="{% url 'añadir_al_carrito' p.id %}" class="bg-black text-white px-10 py-5 font-black uppercase tracking-widest hover:bg-red-600 transition duration-500 shadow-2xl flex items-center space-x-4">
                        <svg class="w-5 h-5 fill-white" viewBox="0 0 24 24"><path d="M7 18c-1.1 0-1.99.9-1.99 2S5.9 22 7 22s2-.9 2-2-.9-2-2-2zM1 2v2h2l3.6 7.59-1.35 2.45c-.16.28-.25.61-.25.96 0 1.1.9 2 2 2h12v-2H7.42c-.14 0-.25-.11-.25-.25l.03-.12.9-1.63h7.45c.75 0 1.41-.41 1.75-1.03l3.58-6.49c.08-.14.12-.31.12-.48 0-.55-.45-1-1-1H5.21l-.94-2H1zm16 16c-1.1 0-1.99.9-1.99 2s.89 2 1.99 2 2-.9 2-2-.9-2-2-2z"/></svg>
                        <span>Añadir al carrito</span>
                    </a>
                {% elif p.stock == 'consulta' %}
                    <!-- BOTÓN OFICIAL DE WHATSAPP -->
                    <a href="https://wa.me/595981123456?text=Hola! Me interesa el producto: {{ p.nombre }}" 
                       target="_blank" 
                       class="bg-[#25D366] text-white px-8 py-4 font-black uppercase tracking-widest hover:bg-[#128C7E] transition-all duration-500 shadow-xl flex items-center space-x-3 rounded-sm">
                        
                        <!-- Icono Oficial de WhatsApp -->
                        <svg class="w-6 h-6 fill-white" role="img" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                            <path d="M17.472 14.382c-.297-.149-1.758-.867-2.03-.967-.273-.099-.471-.148-.67.15-.197.297-.767.966-.94 1.164-.173.199-.347.223-.644.075-.297-.15-1.255-.463-2.39-1.475-.883-.788-1.48-1.761-1.653-2.059-.173-.297-.018-.458.13-.606.134-.133.298-.347.446-.52.149-.174.198-.298.298-.497.099-.198.05-.371-.025-.52-.075-.149-.669-1.612-.916-2.207-.242-.579-.487-.5-.669-.51-.173-.008-.371-.01-.57-.01-.198 0-.52.074-.792.372-.272.297-1.04 1.016-1.04 2.479 0 1.462 1.065 2.875 1.213 3.074.149.198 2.096 3.2 5.077 4.487.709.306 1.262.489 1.694.625.712.227 1.36.195 1.871.118.571-.085 1.758-.719 2.006-1.413.248-.694.248-1.289.173-1.413-.074-.124-.272-.198-.57-.347m-5.421 7.403h-.004a9.87 9.87 0 01-5.031-1.378l-.361-.214-3.741.982.998-3.648-.235-.374a9.86 9.86 0 01-1.51-5.26c.001-5.45 4.436-9.884 9.888-9.884 2.64 0 5.122 1.03 6.988 2.898a9.825 9.825 0 012.893 6.994c-.003 5.45-4.437 9.884-9.885 9.884m8.413-18.297A11.815 11.815 0 0012.05 0C5.495 0 .16 5.335.157 11.892c0 2.096.547 4.142 1.588 5.945L0 24l6.335-1.662c1.889 1.025 3.962 1.562 6.073 1.564h.005c6.554 0 11.89-5.335 11.893-11.893a11.821 11.821 0 00-3.48-8.413z"/>
                        </svg>

                        <span>WhatsApp Consulta</span>
                    </a>
                {% endif %}
                
                <a href="{% url 'lista_productos' %}" class="text-[10px] font-black text-gray-400 hover:text-black uppercase tracking-[0.3em] transition">
                    ← Volver al Catálogo
                </a>
            </div>
        </div>
    </div>

    <!-- SECCIÓN INFERIOR: ESPECIFICACIONES -->
    <div class="mt-12 border-t border-zinc-100 pt-10 max-w-5xl mx-auto">
        <h2 class="text-xl font-black italic uppercase tracking-tighter mb-6 text-zinc-900">Especificaciones Técnicas</h2>
        <div class="space-y-2 max-w-3xl">
            <div class="flex items-center justify-between bg-white border border-zinc-200 rounded-xl px-8 py-4 shadow-sm">
                <span class="text-[10px] font-black uppercase tracking-widest text-gray-400">Marca Oficial</span>
                <span class="text-sm font-bold text-zinc-800 italic uppercase">{{ p.marca.nombre }}</span>
            </div>
            <div class="flex items-center justify-between bg-white border border-zinc-200 rounded-xl px-8 py-4 shadow-sm">
                <span class="text-[10px] font-black uppercase tracking-widest text-gray-400">Categoría</span>
                <span class="text-sm font-bold text-zinc-800 italic uppercase">{{ p.categoria.nombre }}</span>
            </div>
            <div class="flex items-center justify-between bg-white border border-zinc-200 rounded-xl px-8 py-4 shadow-sm">
                <span class="text-[10px] font-black uppercase tracking-widest text-gray-400">Identificador</span>
                <span class="text-sm font-bold text-zinc-800">#TS-00{{ p.id }}</span>
            </div>
        </div>
    </div>
</div>
{% endblock %}